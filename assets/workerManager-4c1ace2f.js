import{e as r}from"./index-fc391d71.js";const a=2*60*1e3;class o{constructor(e){this._defaults=e,this._worker=null,this._idleCheckInterval=window.setInterval(()=>this._checkIfIdle(),30*1e3),this._lastUsedTime=0,this._configChangeListener=this._defaults.onDidChange(()=>this._stopWorker())}_stopWorker(){this._worker&&(this._worker.dispose(),this._worker=null),this._client=null}dispose(){clearInterval(this._idleCheckInterval),this._configChangeListener.dispose(),this._stopWorker()}_checkIfIdle(){if(!this._worker)return;Date.now()-this._lastUsedTime>a&&this._stopWorker()}_getClient(){return this._lastUsedTime=Date.now(),this._client||(this._worker=r.createWebWorker({moduleId:this._defaults.languageId,label:this._defaults.languageId,createData:{languageSettings:this._defaults.diagnosticsOptions,languageId:this._defaults.languageId}}),this._client=this._worker.getProxy()),this._client}getLanguageServiceWorker(...e){let i;return this._getClient().then(t=>{i=t}).then(t=>{var s;return(s=this._worker)===null||s===void 0?void 0:s.withSyncedResources(e)}).then(t=>i)}}export{o as W};
