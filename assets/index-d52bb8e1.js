import{g as O,r as y,j as i,q as W,d as R,I as T,z as P,B as q,C as F,F as X,s as Y,A as J,M as K,c as G,G as Q,H as U,i as V}from"./index-fc391d71.js";import{u as Z,W as L}from"./index-65f064bc.js";import{P as S}from"./index-2d087329.js";import{H as k}from"./index-e50a872e.js";function D(e,r,b="vertical"){const[l,n]=O(),d=b==="vertical"?"width":"height",m=y.useRef(()=>{});y.useEffect(()=>{if(a.length&&a.length===r){const o=a.reduce((u,f)=>u+f);if(o!==n[d]){const f=(n[d]-o)/r;m.current(a.map(x=>x+f))}}},[n[d]]);const a=y.useMemo(()=>e.length&&e.length===r?e:new Array(r).fill(n[d]/r),[e,r]);return[l,a,o=>{m.current=o}]}const H={container:"mo-breadcrumb",item:"mo-breadcrumb__item",label:"mo-breadcrumb__label"};function C({className:e,separator:r,routes:b,onClick:l}){const n=b.length,d=r||i.jsx(T,{type:"chevron-right"});return i.jsx(W,{className:R(e,H.container),role:"breadcrumb",tabIndex:0,children:b.map((m,a)=>{const{id:h,icon:o,render:u,name:f}=m;return i.jsxs("a",{className:R(H.item),tabIndex:0,onContextMenu:x=>x.preventDefault(),onClick:()=>l==null?void 0:l(m),children:[i.jsx(T,{type:o}),i.jsx("span",{className:H.label,children:u?u(m):f}),n-a>1?d:null]},h)})})}const g={tab:"mo-tab",extra:"mo-tab__extra",name:"mo-tab__name",active:"mo-tab--active",dragging:"mo-tab--dragging",extraActive:"mo-tab__extra--active"};function ee({data:e,groupId:r,className:b,active:l,onContextMenu:n,onClick:d,onClose:m,onDragStart:a,onDragEnd:h,onDragEnter:o,onDragLeave:u,onDragOver:f,onDrop:x}){const j=y.useRef(null),[{isDragging:p},v]=P({type:"DND_NODE",collect(t){return{isDragging:t.isDragging()}},item:()=>(a==null||a(e.id,r),{tabId:e.id,groupId:r}),end(t){h==null||h(t.tabId,t.groupId)}}),[{item:s,isOver:I},w]=q({accept:"DND_NODE",collect:t=>({isOver:t.isOver(),item:t.getItem()}),canDrop(t){return t.tabId!==e.id||t.groupId!==r},hover(t,c){f==null||f(c.getItem(),{tabId:e.id,groupId:r})},drop(t,c){x==null||x(c.getItem(),{tabId:e.id,groupId:r})}});return v(w(j)),i.jsx(W,{ref:j,className:R(g.tab,l&&g.active,(p||I)&&g.dragging,b),onContextMenu:t=>n==null?void 0:n({x:t.pageX,y:t.pageY},e.id,r),tabIndex:0,onClick:()=>d==null?void 0:d(e.id,r),onDragEnter:t=>t.currentTarget===t.target&&(o==null?void 0:o(s,{tabId:e.id,groupId:r})),onDragLeave:t=>t.currentTarget===t.target&&(u==null?void 0:u(s,{tabId:e.id,groupId:r})),children:i.jsxs(F,{style:{height:"100%",gap:4},children:[i.jsx(T,{type:e.icon}),i.jsx("span",{className:g.name,children:e.name}),i.jsx("section",{className:R(g.extra,e.modified&&g.extraActive),children:i.jsx(X,{modified:e.modified,onClick:t=>{t.stopPropagation(),m==null||m(e.id,r)}})})]})})}const N={group:"mo-editor__group",active:"mo-editor--active",header:"mo-editor__group__header",breadcrumb:"mo-editor__group__breadcrumb",content:"mo-editor__group__content"};function te({group:e,options:r,toolbar:b,onSelectTab:l,onMount:n,onModelMount:d,onContextMenu:m,onToolbarClick:a,onCloseTab:h,onDragStart:o,onDragEnd:u,onDragEnter:f,onDragLeave:x,onDragOver:j,onDrop:p}){var t;const v=y.useRef(new WeakMap),s=e.data.find(Y(e.activeTab)),I=c=>{n==null||n(e.id,c),c.onDidChangeModel(()=>{const _=c.getModel();if(_){const B=v.current.get(_);B&&(c.restoreViewState(B),c.focus())}}),c.onDidBlurEditorText(()=>{const _=c.getModel();_&&v.current.set(_,c.saveViewState())})},w=c=>{s&&(s.model||d==null||d(s.id,e.id,c))};return s?i.jsxs("div",{className:N.group,children:[i.jsx(k,{scrollIntoViewDeps:{dep:e.activeTab,activeClassName:N.active},className:N.header,trackStyle:{height:3},extra:i.jsx(J,{data:b,onClick:c=>a==null?void 0:a(c,e.id)}),children:e.data.map(c=>{const _=e.activeTab===c.id;return i.jsx(ee,{data:c,groupId:e.id,className:R(_&&N.active),active:_,onContextMenu:m,onClose:h,onClick:l,onDragStart:o,onDragEnd:u,onDragEnter:f,onDragLeave:x,onDragOver:j,onDrop:p},c.id)})}),i.jsx(C,{className:N.breadcrumb,routes:(s==null?void 0:s.breadcrumb)||[]}),i.jsx("div",{className:N.content,children:s.render?(t=s.render)==null?void 0:t.call(s,s):i.jsx(K,{options:{...r,automaticLayout:!0},instance:e.editorInstance,model:s==null?void 0:s.model,value:s==null?void 0:s.value,language:s==null?void 0:s.language,onMount:I,onModelMount:w})})]}):null}const se={container:"mo-editor"};function ne({onMount:e,onModelMount:r,onSelectTab:b,onPaneSizeChange:l,onContextMenu:n,onToolbarClick:d,onCloseTab:m,onDragStart:a,onDragEnd:h,onDragEnter:o,onDragLeave:u,onDragOver:f,onDrop:x}){const j=G("editor"),p=G("layout"),v=Z(),{groups:s=[],current:I,entry:w=i.jsx(L,{}),options:t,toolbar:c,loading:_}=j,B=y.useMemo(()=>({...v.editor,...t}),[t,v.editor]),[$,z,E]=D(p.groupSplitPos,s.length,p.editorDirection);E(A=>l==null?void 0:l(A));const M=()=>i.jsx(Q,{backend:U,context:window,children:i.jsx(V,{ref:$,sizes:z,split:p.editorDirection,onChange:l,children:s.map(A=>i.jsx(V.Pane,{minSize:220,children:i.jsx(te,{group:A,toolbar:c,options:B,onMount:e,onModelMount:r,onSelectTab:b,onContextMenu:n,onToolbarClick:d,onCloseTab:m,onDragStart:a,onDragEnd:h,onDragEnter:o,onDragLeave:u,onDragOver:f,onDrop:x})},A.id))})});return i.jsxs("div",{className:se.container,children:[i.jsx(S,{active:_}),I?M():w]})}export{ne as default};
